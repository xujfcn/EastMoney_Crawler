# ä¸œæ–¹è´¢å¯Œè‚¡å§çˆ¬è™«é¡¹ç›®ä½¿ç”¨è¯´æ˜

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº Selenium çš„ä¸œæ–¹è´¢å¯Œè‚¡å§æ•°æ®çˆ¬è™«é¡¹ç›®ï¼Œä¸“é—¨ç”¨äºæŠ“å–è‚¡å§ä¸­çš„**å‘å¸–ä¿¡æ¯**å’Œ**è¯„è®ºæ•°æ®**ï¼Œå¹¶å°†æ•°æ®å­˜å‚¨åˆ° MongoDB æ•°æ®åº“ä¸­ã€‚é¡¹ç›®æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘çˆ¬å–ï¼Œé€‚åˆè¿›è¡Œè‚¡ç¥¨èˆ†æƒ…åˆ†æå’ŒæŠ•èµ„è€…æƒ…ç»ªç ”ç©¶ã€‚

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
EastMoney_Crawler/
â”œâ”€â”€ æ ¸å¿ƒæ–‡ä»¶/
â”‚   â”œâ”€â”€ main.py                    # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ crawler.py                 # çˆ¬è™«æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ parser.py                  # æ•°æ®è§£æå™¨
â”‚   â”œâ”€â”€ mongodb.py                 # MongoDBæ•°æ®åº“æ¥å£
â”‚   â””â”€â”€ stealth.min.js            # åæ£€æµ‹JavaScriptæ–‡ä»¶
â”œâ”€â”€ é…ç½®æ–‡ä»¶/
â”‚   â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–åŒ…åˆ—è¡¨
â”‚   â””â”€â”€ ä½¿ç”¨è¯´æ˜.md               # æœ¬æ–‡æ¡£
â”œâ”€â”€ è¾…åŠ©å·¥å…·/
â”‚   â””â”€â”€ final_comment_crawler.py   # è¯„è®ºçˆ¬å–ä¿®å¤ç‰ˆæœ¬
â””â”€â”€ ç»“æœæ–‡ä»¶/
    â””â”€â”€ comment_crawl_result.json  # çˆ¬å–ç»“æœè®°å½•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

#### å¿…éœ€è½¯ä»¶
- **Python 3.7+**
- **MongoDB Community Server**
- **Chrome æµè§ˆå™¨**
- **ChromeDriver**ï¼ˆæˆ–ä½¿ç”¨ webdriver-manager è‡ªåŠ¨ç®¡ç†ï¼‰

#### Python ä¾èµ–å®‰è£…
```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœä½¿ç”¨ï¼‰
conda activate qlib

# å®‰è£…ä¾èµ–åŒ…
pip install -r requirements.txt
```

#### MongoDB å¯åŠ¨
**Windows ç”¨æˆ·ï¼š**
1. æŒ‰ `Win + R`ï¼Œè¾“å…¥ `services.msc`
2. æ‰¾åˆ° MongoDB æœåŠ¡å¹¶å¯åŠ¨
3. æˆ–ä½¿ç”¨å‘½ä»¤ï¼š`net start MongoDB`

### 2. é…ç½®å‚æ•°

ç¼–è¾‘ `main.py` æ–‡ä»¶ï¼Œè®¾ç½®çˆ¬å–å‚æ•°ï¼š

```python
if __name__ == "__main__":
    # è®¾ç½®è‚¡ç¥¨ä»£ç 
    stock_code = '002001'  # æ–°å’Œæˆ
    
    # çˆ¬å–å‘å¸–ä¿¡æ¯ï¼ˆæŒ‰é¡µæ•°ï¼‰
    post_crawler = PostCrawler(stock_code)
    post_crawler.crawl_post_info(1, 10)  # çˆ¬å–1-10é¡µ
    
    # çˆ¬å–è¯„è®ºä¿¡æ¯ï¼ˆæŒ‰æ—¥æœŸï¼‰
    comment_crawler = CommentCrawler(stock_code)
    comment_crawler.find_by_date('2024-09-01', '2024-09-13')
    comment_crawler.crawl_comment_info()
```

### 3. è¿è¡Œçˆ¬è™«

```bash
# è¿è¡Œä¸»ç¨‹åº
python main.py

# æˆ–è¿è¡Œä¿®å¤ç‰ˆè¯„è®ºçˆ¬è™«
python final_comment_crawler.py
```

## ğŸ”§ å·¥ä½œåŸç†

### æŠ€æœ¯æ¶æ„

#### 1. åæ£€æµ‹æœºåˆ¶
```python
# ä½¿ç”¨ stealth.min.js éšè—è‡ªåŠ¨åŒ–ç‰¹å¾
with open('stealth.min.js') as f:
    js = f.read()
browser.execute_cdp_cmd("Page.addScriptToEvaluateOnNewDocument", {
    "source": js
})
```

#### 2. æ•°æ®çˆ¬å–æµç¨‹
1. **åˆå§‹åŒ– WebDriver** â†’ å¯åŠ¨ Chrome æµè§ˆå™¨
2. **è®¿é—®è‚¡å§é¡µé¢** â†’ æ¨¡æ‹Ÿç”¨æˆ·è®¿é—®ä¸œæ–¹è´¢å¯Œè‚¡å§
3. **è§£æé¡µé¢æ•°æ®** â†’ æå–å¸–å­ä¿¡æ¯å’Œè¯„è®ºå†…å®¹
4. **å­˜å‚¨åˆ°æ•°æ®åº“** â†’ ä¿å­˜åˆ° MongoDB é›†åˆä¸­

#### 3. æ•°æ®ç»“æ„è®¾è®¡

**å‘å¸–ä¿¡æ¯è¡¨ç»“æ„ï¼š**
```json
{
  "_id": 1,
  "post_title": "å¸–å­æ ‡é¢˜",
  "post_view": "æµè§ˆé‡",
  "comment_num": è¯„è®ºæ•°,
  "post_url": "å¸–å­é“¾æ¥",
  "post_date": "å‘å¸–æ—¥æœŸ",
  "post_time": "å‘å¸–æ—¶é—´",
  "post_author": "å‘å¸–äºº"
}
```

**è¯„è®ºä¿¡æ¯è¡¨ç»“æ„ï¼š**
```json
{
  "post_id": å…³è”å¸–å­ID,
  "comment_content": "è¯„è®ºå†…å®¹",
  "comment_like": ç‚¹èµæ•°,
  "comment_date": "è¯„è®ºæ—¥æœŸ",
  "comment_time": "è¯„è®ºæ—¶é—´",
  "sub_comment": æ˜¯å¦ä¸ºäºŒçº§è¯„è®º
}
```

### æ ¸å¿ƒç®—æ³•

#### 1. æ™ºèƒ½å¹´ä»½æ¨æ–­
```python
def parse_post_date(self, html):
    # é¡µé¢åªæ˜¾ç¤ºæœˆæ—¥ï¼Œé€šè¿‡æœˆä»½å˜åŒ–æ¨æ–­å¹´ä»½
    if self.month < month == 12:
        self.year -= 1
    self.month = month
```

#### 2. é‡è¯•æœºåˆ¶
- **è®¿é—®é™åˆ¶å¤„ç†**ï¼šçº¦660é¡µåè‡ªåŠ¨é‡å¯WebDriver
- **å¼‚å¸¸æ¢å¤**ï¼šç½‘ç»œå¼‚å¸¸æ—¶è‡ªåŠ¨åˆ·æ–°é‡è¯•
- **æ–­ç‚¹ç»­çˆ¬**ï¼šæ”¯æŒä»æŒ‡å®šIDæˆ–é¡µæ•°ç»§ç»­

#### 3. æ•°æ®å»é‡
- åŸºäºå¸–å­IDå’Œè¯„è®ºå†…å®¹è¿›è¡Œå»é‡
- å¤„ç†çƒ­é—¨è¯„è®ºå’Œå…¨éƒ¨è¯„è®ºçš„é‡å¤é—®é¢˜

## âš ï¸ ä½¿ç”¨é™åˆ¶ä¸æ³¨æ„äº‹é¡¹

### æŠ€æœ¯é™åˆ¶

#### 1. è®¿é—®é¢‘ç‡é™åˆ¶
- **é¡µé¢é™åˆ¶**ï¼šè¿ç»­çˆ¬å–çº¦660é¡µåä¼šè¢«é™åˆ¶è®¿é—®
- **è§£å†³æ–¹æ¡ˆ**ï¼šè‡ªåŠ¨é‡å¯WebDriverç»§ç»­çˆ¬å–
- **å»ºè®®**ï¼šè®¾ç½®åˆç†çš„å»¶æ—¶é—´éš”

#### 2. åçˆ¬æœºåˆ¶
- **æ£€æµ‹æ–¹å¼**ï¼šç½‘ç«™å¯èƒ½æ£€æµ‹è‡ªåŠ¨åŒ–è¡Œä¸º
- **åº”å¯¹æªæ–½**ï¼šä½¿ç”¨stealth.jséšè—è‡ªåŠ¨åŒ–ç‰¹å¾
- **é£é™©**ï¼šå¯èƒ½éœ€è¦éªŒè¯ç æˆ–IPè¢«å°

#### 3. æ•°æ®å®Œæ•´æ€§
- **è¯„è®ºåŠ è½½**ï¼šéƒ¨åˆ†è¯„è®ºéœ€è¦ç‚¹å‡»"å±•å¼€"æ‰èƒ½æ˜¾ç¤º
- **æ—¶é—´è§£æ**ï¼šé¡µé¢åªæ˜¾ç¤ºæœˆæ—¥ï¼Œå¹´ä»½éœ€è¦ç®—æ³•æ¨æ–­
- **ç‰¹æ®Šå¸–å­**ï¼šæŸäº›å®˜æ–¹å¸–å­å¯èƒ½æ— æ³•æ­£å¸¸è§£æ

### æ³•å¾‹ä¸é“å¾·é™åˆ¶

#### 1. ä½¿ç”¨è§„èŒƒ
- **ä»…é™å­¦ä¹ ç ”ç©¶**ï¼šä¸å¾—ç”¨äºå•†ä¸šç”¨é€”
- **éµå®ˆrobots.txt**ï¼šå°Šé‡ç½‘ç«™çš„çˆ¬å–è§„åˆ™
- **åˆç†é¢‘ç‡**ï¼šé¿å…å¯¹æœåŠ¡å™¨é€ æˆè¿‡å¤§å‹åŠ›

#### 2. æ•°æ®ä½¿ç”¨
- **éšç§ä¿æŠ¤**ï¼šä¸å¾—æ³„éœ²ç”¨æˆ·ä¸ªäººä¿¡æ¯
- **ç‰ˆæƒå°Šé‡**ï¼šå†…å®¹ç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰
- **åˆè§„ä½¿ç”¨**ï¼šéµå®ˆç›¸å…³æ³•å¾‹æ³•è§„

### ç¯å¢ƒä¾èµ–

#### 1. ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šWindows/Linux/macOS
- **å†…å­˜è¦æ±‚**ï¼šå»ºè®®4GBä»¥ä¸Š
- **ç½‘ç»œç¯å¢ƒ**ï¼šç¨³å®šçš„äº’è”ç½‘è¿æ¥

#### 2. è½¯ä»¶ç‰ˆæœ¬
- **Chromeæµè§ˆå™¨**ï¼šå»ºè®®æœ€æ–°ç‰ˆæœ¬
- **ChromeDriver**ï¼šéœ€ä¸Chromeç‰ˆæœ¬åŒ¹é…
- **MongoDB**ï¼š4.0ä»¥ä¸Šç‰ˆæœ¬

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. MongoDBè¿æ¥å¤±è´¥
```
é”™è¯¯ï¼šlocalhost:27017: [WinError 10061] è¿æ¥è¢«æ‹’ç»
è§£å†³ï¼šå¯åŠ¨MongoDBæœåŠ¡
```

#### 2. ChromeDriverç‰ˆæœ¬ä¸åŒ¹é…
```
é”™è¯¯ï¼šThis version of ChromeDriver only supports Chrome version XX
è§£å†³ï¼šä¸‹è½½åŒ¹é…çš„ChromeDriverç‰ˆæœ¬
```

#### 3. æ¨¡å—å¯¼å…¥å†²çª
```
é”™è¯¯ï¼šAttributeError: module 'parser' has no attribute 'PostParser'
è§£å†³ï¼šä½¿ç”¨final_comment_crawler.pyä¿®å¤ç‰ˆæœ¬
```

### è°ƒè¯•å»ºè®®

#### 1. æ—¥å¿—æŸ¥çœ‹
- æ£€æŸ¥ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶äº†è§£æ‰§è¡ŒçŠ¶æ€
- å…³æ³¨é”™è¯¯ä¿¡æ¯å’Œå¼‚å¸¸å †æ ˆ

#### 2. æ•°æ®éªŒè¯
```python
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
from pymongo import MongoClient
client = MongoClient()
print(client.list_database_names())

# æŸ¥çœ‹çˆ¬å–ç»“æœ
from mongodb import MongoAPI
db = MongoAPI('post_info', 'post_002001')
print(f"å‘å¸–æ•°é‡: {db.count_documents()}")
```

## ğŸ“Š æ•°æ®åˆ†æåº”ç”¨

### å¯åˆ†æç»´åº¦

#### 1. æŠ•èµ„è€…æƒ…ç»ªåˆ†æ
- é€šè¿‡å¸–å­æ ‡é¢˜å’Œè¯„è®ºå†…å®¹åˆ†æå¸‚åœºæƒ…ç»ª
- ç»Ÿè®¡æ­£é¢/è´Ÿé¢è¯æ±‡å‡ºç°é¢‘ç‡
- åˆ†ææƒ…ç»ªå˜åŒ–è¶‹åŠ¿

#### 2. è®¨è®ºçƒ­åº¦åˆ†æ
- ç»Ÿè®¡ä¸åŒæ—¶é—´æ®µçš„å‘å¸–é‡å’Œè¯„è®ºé‡
- åˆ†ææµè§ˆé‡å’Œè¯„è®ºæ•°çš„ç›¸å…³æ€§
- è¯†åˆ«çƒ­é—¨è¯é¢˜å’Œå…³é”®äº‹ä»¶

#### 3. ç”¨æˆ·è¡Œä¸ºåˆ†æ
- åˆ†ææ´»è·ƒç”¨æˆ·çš„å‘å¸–æ¨¡å¼
- ç»Ÿè®¡ç”¨æˆ·å‚ä¸åº¦å’Œå½±å“åŠ›
- ç ”ç©¶ç”¨æˆ·äº’åŠ¨ç½‘ç»œ

### ç¤ºä¾‹åˆ†æä»£ç 

```python
import pandas as pd
from mongodb import MongoAPI

# è¯»å–æ•°æ®
postdb = MongoAPI('post_info', 'post_002001')
posts = list(postdb.find())
df = pd.DataFrame(posts)

# åŸºç¡€ç»Ÿè®¡
print(f"æ€»å¸–å­æ•°: {len(df)}")
print(f"å¹³å‡æµè§ˆé‡: {df['post_view'].mean()}")
print(f"å¹³å‡è¯„è®ºæ•°: {df['comment_num'].mean()}")

# æ—¶é—´åˆ†æ
df['post_date'] = pd.to_datetime(df['post_date'])
daily_posts = df.groupby('post_date').size()
print("æ¯æ—¥å‘å¸–é‡:")
print(daily_posts.head())
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.1 (2024-09-13)
- âœ… ä¿®å¤äº†parseræ¨¡å—å¯¼å…¥å†²çªé—®é¢˜
- âœ… æ”¹è¿›äº†æ•°æ®åº“å­—æ®µè®¿é—®é€»è¾‘
- âœ… å¢åŠ äº†è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… ä¼˜åŒ–äº†è¯„è®ºçˆ¬å–çš„ç¨³å®šæ€§

### v1.0 (åˆå§‹ç‰ˆæœ¬)
- âœ… å®ç°åŸºç¡€çš„å‘å¸–ä¿¡æ¯çˆ¬å–
- âœ… å®ç°è¯„è®ºä¿¡æ¯çˆ¬å–
- âœ… é›†æˆMongoDBæ•°æ®å­˜å‚¨
- âœ… æ·»åŠ åæ£€æµ‹æœºåˆ¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

### å¼€å‘å»ºè®®
1. éµå¾ªPEP 8ä»£ç è§„èŒƒ
2. æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£
3. æµ‹è¯•æ–°åŠŸèƒ½çš„ç¨³å®šæ€§
4. è€ƒè™‘æ€§èƒ½å’Œèµ„æºä½¿ç”¨

### è”ç³»æ–¹å¼
å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡GitHub Issuesè”ç³»ã€‚

---

**å…è´£å£°æ˜**ï¼šæœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œä½¿ç”¨è€…éœ€è‡ªè¡Œæ‰¿æ‹…ä½¿ç”¨é£é™©ï¼Œå¹¶éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚